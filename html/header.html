<script>
document.addEventListener('DOMContentLoaded', function() {
  // Find all R code blocks that should be toggleable.
  // Our Lua filter adds the 'r-code-box' class to the code block.
  var codeBlocks = document.querySelectorAll('.r-code-box');

  codeBlocks.forEach(function(codeBlock) {
    // Create the button element
    var button = document.createElement('button');
    button.textContent = 'Show R Code'; // Initial text for the button
    button.className = 'code-toggle-button'; // Assign CSS class

    // Insert the button directly before the code block.
    // The codeBlock's parentNode is the div.figure-with-code container.
    // We insert the button as a sibling of the codeBlock within that container.
    codeBlock.parentNode.insertBefore(button, codeBlock);

    // Hide the code block initially by default.
    codeBlock.style.display = 'none';

    // Add a click event listener to the button
    button.addEventListener('click', function() {
      if (codeBlock.style.display === 'none') {
        codeBlock.style.display = 'block'; // Show the code block
        button.textContent = 'Hide R Code'; // Change button text
      } else {
        codeBlock.style.display = 'none'; // Hide the code block
        button.textContent = 'Show R Code'; // Change button text back
      }
    });
  });
});
</script>